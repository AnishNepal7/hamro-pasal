@extends('layouts.app')

@section('content')
<div class="container mx-auto px-4 py-8">
    <!-- Page Header -->
    <!-- <div class="mb-8">
        <h1 class="text-4xl font-bold metallic-text font-orbitron mb-2">DASHBOARD</h1>
        <p class="text-metallic-mid">Real-time overview of your inventory management system</p>
    </div> -->

    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Total Products -->
        <div class="metallic-card p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-metallic-mid text-sm font-medium">Total Products</p>
                    <p class="text-3xl font-bold text-white">{{ number_format($totalProducts) }}</p>
                </div>
                <div class="bg-blue-500/20 p-3 rounded-full">
                    <span class="text-2xl">üì¶</span>
                </div>
            </div>
        </div>

        <!-- Total Sales Revenue -->
        <div class="metallic-card p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-metallic-mid text-sm font-medium">Total Sales</p>
                    <p class="text-3xl font-bold text-metallic-gold">Rs.{{ number_format($totalSales, 2) }}</p>
                </div>
                <div class="bg-metallic-gold/20 p-3 rounded-full">
                    <span class="text-2xl">üí∞</span>
                </div>
            </div>
        </div>

        <!-- Today's Sales -->
        <div class="metallic-card p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-metallic-mid text-sm font-medium">Today's Sales</p>
                    <p class="text-3xl font-bold text-green-400">Rs.{{ number_format($todaySales, 2) }}</p>
                </div>
                <div class="bg-green-500/20 p-3 rounded-full">
                    <span class="text-2xl">üìà</span>
                </div>
            </div>
        </div>

        <!-- Low Stock Alerts -->
        <div class="metallic-card p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-metallic-mid text-sm font-medium">Low Stock Items</p>
                    <p class="text-3xl font-bold text-red-400">{{ $lowStockProducts }}</p>
                </div>
                <div class="bg-red-500/20 p-3 rounded-full">
                    <span class="text-2xl">‚ö†Ô∏è</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Sales Performance Chart -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
        <div class="lg:col-span-2">
            <div class="metallic-card p-6">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h3 class="text-xl font-bold text-metallic-mid mb-1">Sales Performance</h3>
                        <p class="text-steel-100 text-sm">Track your sales trends over time</p>
                    </div>
                    <div class="flex space-x-2">
                        <button id="monthlyViewBtn" class="chart-toggle-btn active px-4 py-2 text-sm rounded-lg">Monthly</button>
                        <button id="dailyViewBtn" class="chart-toggle-btn px-4 py-2 text-sm rounded-lg">Daily</button>
                    </div>
                </div>
                
                <div class="relative" style="height: 400px;">
                    <canvas id="salesChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Top Products -->
        <div class="metallic-card p-6">
            <h3 class="text-xl font-bold text-metallic-mid mb-4">Top Products</h3>
            <div class="space-y-4">
                @forelse($topProducts as $product)
                    <div class="flex items-center justify-between p-3 bg-steel-800/30 rounded-lg">
                        <div>
                            <p class="text-white font-medium">{{ $product->name }}</p>
                            <p class="text-steel-100 text-sm">{{ $product->total_quantity }} sold</p>
                        </div>
                        <div class="text-right">
                            <p class="text-metallic-gold font-bold">Rs.{{ number_format($product->total_revenue, 2) }}</p>
                        </div>
                    </div>
                @empty
                    <p class="text-steel-100 text-center py-4">No sales data available</p>
                @endforelse
            </div>
        </div>
    </div>

    <!-- Recent Activity and Alerts -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Recent Sales -->
        <div class="metallic-card p-6">
            <h3 class="text-xl font-bold text-metallic-mid mb-4">Recent Sales</h3>
            <div class="space-y-3">
                @forelse($recentSales as $sale)
                    <div class="flex items-center justify-between p-3 bg-steel-800/30 rounded-lg">
                        <div>
                            <p class="text-white font-medium">{{ $sale['product_name'] }}</p>
                            <p class="text-steel-100 text-sm">
                                {{ $sale['quantity'] }} √ó Rs.{{ number_format($sale['unit_price'], 2) }} 
                                ‚Ä¢ {{ $sale['user_name'] }}
                            </p>
                            <p class="text-steel-100 text-xs">{{ $sale['created_at'] }}</p>
                        </div>
                        <div class="text-metallic-gold font-bold">
                            Rs.{{ number_format($sale['total_amount'], 2) }}
                        </div>
                    </div>
                @empty
                    <p class="text-steel-100 text-center py-4">No recent sales</p>
                @endforelse
            </div>
        </div>

        <!-- Low Stock Alerts -->
        <div class="metallic-card p-6">
            <h3 class="text-xl font-bold text-metallic-mid mb-4">Low Stock Alerts</h3>
            <div class="space-y-3">
                @forelse($lowStockAlerts as $product)
                    <div class="flex items-center justify-between p-3 bg-red-500/10 border border-red-500/20 rounded-lg">
                        <div>
                            <p class="text-white font-medium">{{ $product['name'] }}</p>
                            <p class="text-steel-100 text-sm">
                                {{ $product['category'] }} ‚Ä¢ {{ $product['supplier'] }}
                            </p>
                        </div>
                        <div class="text-right">
                            <p class="text-red-400 font-bold">{{ $product['current_stock'] }}</p>
                            <p class="text-steel-100 text-xs">Min: {{ $product['reorder_level'] }}</p>
                        </div>
                    </div>
                @empty
                    <p class="text-steel-100 text-center py-4">All products are well stocked</p>
                @endforelse
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Chart.js configuration
    const ctx = document.getElementById('salesChart').getContext('2d');
    
    // Monthly data from controller
    const monthlyData = {
        labels: @json($monthlySalesData['labels']),
        revenues: @json($monthlySalesData['revenues']),
        quantities: @json($monthlySalesData['quantities'])
    };
    
    // Daily data from controller
    const dailyData = {
        labels: @json($dailySalesData['labels']),
        revenues: @json($dailySalesData['revenues']),
        quantities: @json($dailySalesData['quantities'])
    };
    
    // Chart configuration with metallic theme
    const chartConfig = {
        type: 'line',
        data: {
            labels: monthlyData.labels,
            datasets: [{
                label: 'Revenue ($)',
                data: monthlyData.revenues,
                borderColor: '#d4af37',
                backgroundColor: 'rgba(212, 175, 55, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#d4af37',
                pointBorderColor: '#d4af37',
                pointRadius: 6,
                pointHoverRadius: 8,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: '#c5d1d5',
                        font: {
                            family: 'Roboto',
                            size: 12
                        }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(45, 55, 72, 0.95)',
                    titleColor: '#d4af37',
                    bodyColor: '#c5d1d5',
                    borderColor: '#d4af37',
                    borderWidth: 1,
                    callbacks: {
                        label: function(context) {
                            return 'Revenue: Rs.' + context.parsed.y.toLocaleString();
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(197, 209, 213, 0.1)',
                        borderColor: 'rgba(197, 209, 213, 0.3)'
                    },
                    ticks: {
                        color: '#c5d1d5',
                        font: {
                            family: 'Roboto',
                            size: 11
                        }
                    }
                },
                y: {
                    grid: {
                        color: 'rgba(197, 209, 213, 0.1)',
                        borderColor: 'rgba(197, 209, 213, 0.3)'
                    },
                    ticks: {
                        color: '#c5d1d5',
                        font: {
                            family: 'Roboto',
                            size: 11
                        },
                        callback: function(value) {
                            return 'Rs.' + value.toLocaleString();
                        }
                    }
                }
            },
            interaction: {
                intersect: false,
                mode: 'index'
            }
        }
    };
    
    // Initialize chart
    const salesChart = new Chart(ctx, chartConfig);
    
    // View switching functionality
    const monthlyBtn = document.getElementById('monthlyViewBtn');
    const dailyBtn = document.getElementById('dailyViewBtn');
    
    monthlyBtn.addEventListener('click', function() {
        updateChart(monthlyData, 'Monthly');
        setActiveButton(monthlyBtn, dailyBtn);
    });
    
    dailyBtn.addEventListener('click', function() {
        updateChart(dailyData, 'Daily');
        setActiveButton(dailyBtn, monthlyBtn);
    });
    
    function updateChart(data, period) {
        salesChart.data.labels = data.labels;
        salesChart.data.datasets[0].data = data.revenues;
        salesChart.data.datasets[0].label = 'Revenue (Rs.) - ' + period;
        salesChart.update('resize');
    }
    
    function setActiveButton(activeBtn, inactiveBtn) {
        activeBtn.classList.add('active');
        inactiveBtn.classList.remove('active');
    }
});
</script>
@endsection



